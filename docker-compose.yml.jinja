version: "3"

volumes:
  # These volumes need to be created manually first

  # docker volume create conda-envs
  #  -OR-
  # docker volume create --opt type=none --opt o=bind --opt device=/mnt/local/disk2/conda-envs/ conda-envs
  conda-envs:
    external: true
  
  # docker volume create --opt type=none --opt o=bind --opt device=/mnt/local/disk2/genomes/{{ species }}/resources/ {{ species }}
  {{ species }}:
    external: true

  # docker volume create --opt type=none --opt o=bind --opt device=/mnt/local/disk2/bigtmp/ bigtmp
  bigtmp:
    external: true

services:
  workflow:
    build:
      context: .
      dockerfile: Dockerfile
    image: rnaseq:latest
    command: ["snakemake","--use-conda","-c10","-p"]
    volumes:
      - "./config:/mnt/workflow/config"
      - "./resources:/mnt/workflow/resources"
      - "./results:/mnt/workflow/results"
      - "./workflow:/mnt/workflow/workflow"
      - conda-envs:/conda-envs
      - "{{ species }}:/mnt/workflow/resources/{{ species }}"
      - bigtmp:/bigtmp